---
{"tags":["domain:meta","status:canonical","format:spec","feature:graph"],"created":"2026-02-21","updated":"2026-02-21","tier":2,"title":"ІНВАРІАНТИ ГРАФУ ЗНАНЬ","dg-publish":true,"dg-metatags":null,"dg-home":null,"permalink":"/exodus.pp.ua/architecture/governance/ІНВАРІАНТИ_ГРАФУ_ЗНАНЬ/","dgPassFrontmatter":true,"noteIcon":""}
---


# Knowledge Graph Invariants

> Створено: 2026-02-21
> Автор: Головний архітектор системи
> Статус: Canonical
> Мова: Українська (канонічна)

---

## 0. Призначення

Цей документ є **машинно-читабельною та людино-верифікованою базою інваріантів** knowledge graph Garden Bloom. Він слугує:

1. **Rule base для `semantic-guard`**: агент перевіряє нові та змінені документи проти цих інваріантів
2. **Джерелом правди**: якщо документ суперечить інваріанту — документ неправильний, не інваріант
3. **Журналом архітектурних рішень**: кожен інваріант посилається на первинне рішення

Інваріанти — не дублювання [[АРХІТЕКТУРНИЙ_КОРІНЬ]]. Вони — **операційна перевірка**: "яку конкретну фразу в новому документі `semantic-guard` має вважати порушенням?"

---

## 1. Структурні інваріанти графу

### I-S1: Кожен canonical документ мусить мати "Семантичні зв'язки"

```
RULE: кожен .md файл у docs/ (крім excluded: _quarantine/, CLAUDE.md)
      ПОВИНЕН мати секцію "## Семантичні зв'язки" або "## ЗВ'ЯЗКИ"
      АБО мати frontmatter поле `isolated: intentional`
VIOLATION: відсутня секція, немає isolated:intentional
SEVERITY: MEDIUM (Tier 1), LOW (Tier 2)
AGENT: graph-linter
PROPOSAL: propose-semantic-links-section
```

### I-S2: wiki-link не може вказувати на неіснуючий файл

```
RULE: кожне [[TargetName]] у документі
      ПОВИННО відповідати файлу у docs/ або бути в aliases registry
VIOLATION: target file не знайдений, alias не визначений
SEVERITY: HIGH
AGENT: graph-linter
PROPOSAL: propose-link-fix
```

### I-S3: Orphan node без навмисної ізоляції — помилка

```
RULE: документ у docs/ без жодного вхідного [[wiki-link]] з інших docs/
      ПОВИНЕН мати frontmatter поле `isolated: intentional` з поясненням
VIOLATION: нуль inlinks, немає `isolated: intentional`
SEVERITY: LOW
AGENT: graph-linter
PROPOSAL: propose-semantic-links-section (з боку referrer)
NOTE: АУДІО_ПРОМПТ_NOTEBOOKLM.md має isolated:intentional — норма
```

### I-S4: GRAPH_MAP оновлюється при появі нового Tier 1 вузла

```
RULE: якщо новий документ класифікований як tier:1,
      КАРТА_ГРАФУ.md ПОВИНЕН бути оновлений з новим рядком у таблиці §1
VIOLATION: новий Tier 1 файл є, КАРТА_ГРАФУ.md не містить його ID
SEVERITY: MEDIUM
AGENT: content-router
PROPOSAL: propose-graph-map-update
```

### I-S5: Мінімум 2 meaningful outbound wiki-links

```
RULE: кожен canonical документ у docs/ ПОВИНЕН мати ≥2 вихідних [[wiki-links]]
      у секції "Семантичні зв'язки" або у тілі документа
VIOLATION: менше 2 outbound wiki-links
SEVERITY: LOW
AGENT: graph-linter
PROPOSAL: propose-semantic-links-enrichment
EXCEPTION: documents з isolated:intentional; INDEX-type docs (ІНДЕКС.md, КАРТА_*)
```

### I-S6: Мінімум 1 inbound wiki-link

```
RULE: кожен canonical документ у docs/ ПОВИНЕН мати ≥1 вхідний [[wiki-link]] з іншого docs/ документа
VIOLATION: нуль inlinks
SEVERITY: LOW
AGENT: graph-linter
PROPOSAL: propose-inbound-link (add link у parent або layer map)
EXCEPTION: documents з isolated:intentional
```

### I-S7: Новий документ → оновити карту шару або ІНДЕКС

```
RULE: якщо в docs/ з'являється новий файл без inlinks через 24h,
      content-router пропонує додати посилання у відповідний parent:
      - Tier 1 → КАРТА_ГРАФУ + ІНДЕКС + карта шару (якщо є)
      - Tier 2 → КАРТА_ГРАФУ + батьківський canonical doc
      - operations → КАРТА_СИСТЕМИ operations section
VIOLATION: новий файл існує без inlinks понад 24h, немає isolated:intentional
SEVERITY: LOW
AGENT: content-router
PROPOSAL: propose-inbound-link
```

---

## 2. Архітектурні інваріанти (Authority Model)

### I-A1: Єдина точка запису — Gateway

```
RULE: жодний компонент крім Gateway (Cloudflare Worker) НЕ має права
      записувати у MinIO canonical knowledge state НАПРЯМУ
VIOLATION: документ стверджує що "Mastra записує в MinIO" або
           "Orchestration Layer оновлює storage" без Proposal/Gateway посередника
SEVERITY: CRITICAL
AGENT: semantic-guard
SOURCE: АРХІТЕКТУРНИЙ_КОРІНЬ.md §Axiom A5
PROPOSAL: propose-contradiction-flag
```

### I-A2: Мутація вимагає явної згоди (Proposal)

```
RULE: будь-яке твердження про автоматичну зміну knowledge state
      без Proposal lifecycle є порушенням
VIOLATION: "агент автоматично оновлює нотатку", "система сама застосовує..."
           без слів "proposal", "approve", "Owner"
SEVERITY: CRITICAL
AGENT: semantic-guard
SOURCE: АРХІТЕКТУРНИЙ_КОРІНЬ.md §Axiom A2
PROPOSAL: propose-contradiction-flag
```

### I-A3: Mastra — stateless runtime

```
RULE: Mastra НЕ зберігає state між runs
VIOLATION: "Mastra кешує результати між запусками", "Mastra має внутрішню пам'ять"
SEVERITY: HIGH
AGENT: semantic-guard
SOURCE: АРХІТЕКТУРНИЙ_КОРІНЬ.md §Axiom A3
PROPOSAL: propose-contradiction-flag
```

### I-A4: Storage — єдине canonical authority

```
RULE: MinIO є єдиним джерелом правди про знання системи
VIOLATION: "Frontend є авторитетним джерелом даних",
           "Orchestration Layer визначає canonical state"
SEVERITY: CRITICAL
AGENT: semantic-guard
SOURCE: АРХІТЕКТУРНИЙ_КОРІНЬ.md §Axiom A1
PROPOSAL: propose-contradiction-flag
```

---

## 3. Proposal lifecycle інваріанти

### I-P1: Статуси Proposal — canonical enum

```
RULE: статус proposal — рівно одне з: pending | approved | rejected | applying | applied | failed
VIOLATION: документ вживає "accepted" замість "approved",
           "declined" замість "rejected", "done" замість "applied"
SEVERITY: HIGH
AGENT: semantic-guard
SOURCE: INBOX_ТА_PROPOSAL_АРХІТЕКТУРА.md §Proposal Lifecycle
PROPOSAL: propose-contradiction-flag + propose-terminology-fix
```

### I-P2: Proposal — від агента, не від системи

```
RULE: proposals створюються агентами (або людиною вручну),
      але НЕ автоматично системою без агента
VIOLATION: "Gateway автоматично генерує proposal при...",
           "система сама пропонує"
SEVERITY: MEDIUM
AGENT: semantic-guard
PROPOSAL: propose-contradiction-flag
```

---

## 4. Agent contract інваріанти

### I-C1: Агент активується тільки за наявності _agent.md

```
RULE: агент існує як runtime entity тільки якщо у MinIO є agents/<slug>/_agent.md
VIOLATION: "папка agents/X/ автоматично визначає агента X"
SEVERITY: MEDIUM
AGENT: semantic-guard
SOURCE: КОНТРАКТ_АГЕНТА_V1.md §Activation
PROPOSAL: propose-contradiction-flag
```

### I-C2: DRAKON pseudocode — canonical logic format

```
RULE: якщо _agent.md посилається на pseudocode.md або .drakon.json,
      ці файли ПОВИННІ існувати у тій самій папці
VIOLATION: _agent.md має поле `logic_file: pseudocode.md`, але файл відсутній
SEVERITY: HIGH
AGENT: graph-linter (structural) + semantic-guard (content)
PROPOSAL: propose-drakon-sync
```

### I-C3: safe_outputs[] обмежують агента

```
RULE: агент НЕ може виконувати дії поза переліком safe_outputs[] у _agent.md
VIOLATION: документ описує агента, що "може редагувати будь-який файл",
           "має необмежений доступ до MinIO"
SEVERITY: CRITICAL
AGENT: semantic-guard
SOURCE: КОНТРАКТ_АГЕНТА_V1.md §2.2
PROPOSAL: propose-contradiction-flag
```

---

## 5. Tag system інваріанти

### I-T1: Кожен документ має мінімальний набір тегів

```
RULE: frontmatter ПОВИНЕН містити мінімум 3 теги:
      рівно 1 domain:*, рівно 1 status:*, рівно 1 format:*
VIOLATION: відсутній frontmatter, або відсутній будь-який з обов'язкових рівнів
SEVERITY: MEDIUM
AGENT: tag-auditor
PROPOSAL: propose-tag-template
```

### I-T2: Теги — тільки з canonical taxonomy

```
RULE: кожен тег у frontmatter ПОВИНЕН бути у TAG_TAXONOMY.yaml
      або мати alias у taxonomy aliases
VIOLATION: тег не знайдений у taxonomy та не є alias
SEVERITY: HIGH
AGENT: tag-auditor
PROPOSAL: propose-tag-normalize
```

### I-T3: feature:X тег передбачає wiki-link

```
RULE: якщо frontmatter містить feature:X,
      у "Семантичні зв'язки" ПОВИНЕН бути [[відповідний вузол]]
      (mapping визначений у КАНОНІЧНА_СИСТЕМА_ТЕГУВАННЯ.md §8.1)
VIOLATION: feature:proposal є, [[INBOX_ТА_PROPOSAL_АРХІТЕКТУРА]] відсутній
SEVERITY: LOW
AGENT: tag-auditor
PROPOSAL: propose-tag-link-fix
```

---

## 6. Термінологічні інваріанти

### I-Term1: Canonical термінологія компонентів

```
RULE: у docs/ архітектурних документах ПОВИННА використовуватись canonical термінологія:
      - Gateway = Cloudflare Worker (єдина точка входу)
      - Orchestration Layer = Hatchet (або vendor-agnostic adapter)
      - Runtime = Mastra
      - Storage = MinIO
VIOLATION: "Orchestration Layer" у значенні Cloudflare Worker,
           "Backend шар" замість Runtime,
           "Replit FastAPI" у ролі Runtime (це пре-Mastra архітектура)
SEVERITY: MEDIUM
AGENT: semantic-guard
SOURCE: АРХІТЕКТУРНИЙ_КОРІНЬ.md §7 Термінологічне уточнення
PROPOSAL: propose-terminology-fix
```

### I-Term2: Мовна норма

```
RULE: архітектурні документи у docs/architecture/ ПОВИННІ бути написані
      українською (за винятком технічних ідентифікаторів)
VIOLATION: документ у docs/architecture/ написаний переважно англійською
SEVERITY: LOW
AGENT: semantic-guard
SOURCE: КАНОНІЗАЦІЯ_МОВИ.md
PROPOSAL: propose-translation-flag (не автозаміна)
EXCEPTION: PROJECT_DESCRIPTION_CANONICAL.md (явно позначений як English canonical)
```

---

## 7. Confidence рівні та routing

| Рівень | Значення | Маршрут |
|--------|----------|---------|
| `CRITICAL` | Порушення аксіоматичного інваріанту | Human review обов'язковий, блокує merge |
| `HIGH` | Серйозне відхилення, потенційно propagating | Human review обов'язковий |
| `MEDIUM` | Структурна проблема, не блокує систему | Human review, може auto-approve через 48h |
| `LOW` | Косметична або опційна рекомендація | Auto-approve через 24h якщо Owner не veto |

---

## 8. Версіонування інваріантів

Кожен інваріант має:
- **ID** (`I-S1`, `I-A2` тощо) — стабільний після додавання
- **SOURCE** — первинний документ-авторитет
- **SEVERITY** — severity при порушенні
- **PROPOSAL** — тип proposal, який агент генерує при порушенні

Зміна інваріанту (не добавка) → обов'язково через Proposal із посиланням на архітектурне рішення.

---

## Семантичні зв'язки

**Цей документ деталізує:**
- [[АРХІТЕКТУРНИЙ_КОРІНЬ]] — операціоналізує аксіоми A1–A7 у верифіковані правила
- [[INBOX_ТА_PROPOSAL_АРХІТЕКТУРА]] — proposal lifecycle інваріанти (§3)
- [[КОНТРАКТ_АГЕНТА_V1]] — agent contract інваріанти (§4)

**Цей документ залежить від:**
- [[АРХІТЕКТУРНИЙ_КОРІНЬ]] — аксіоми як первинне джерело всіх архітектурних інваріантів
- [[INBOX_ТА_PROPOSAL_АРХІТЕКТУРА]] — canonical proposal statuses
- [[КОНТРАКТ_АГЕНТА_V1]] — canonical agent activation rules
- [[КАНОНІЧНА_СИСТЕМА_ТЕГУВАННЯ]] — tag system invariants (§5)
- [[КАНОНІЗАЦІЯ_МОВИ]] — мовні норми (I-Term2)

**Від цього документа залежать:**
- `agents/semantic-guard/_agent.md` — читає §1–6 як rule base
- `agents/graph-linter/_agent.md` — читає §1 як structural check rules
- `agents/tag-auditor/_agent.md` — читає §5 як tag validation rules

---

*Цей документ є операційною базою правил для агентів knowledge integrity системи Garden Bloom.*
