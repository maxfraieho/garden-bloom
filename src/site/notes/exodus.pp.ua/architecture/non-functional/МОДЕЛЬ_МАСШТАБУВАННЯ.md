---
{"tags":["domain:arch","status:canonical","format:spec","feature:execution"],"created":"2026-02-22","updated":"2026-02-22","tier":1,"title":"МОДЕЛЬ МАСШТАБУВАННЯ","dg-publish":true,"dg-metatags":null,"dg-home":null,"permalink":"/exodus.pp.ua/architecture/non-functional/МОДЕЛЬ_МАСШТАБУВАННЯ/","dgPassFrontmatter":true,"noteIcon":""}
---


# МОДЕЛЬ_МАСШТАБУВАННЯ

> Створено: 2026-02-22
> Автор: Головний архітектор системи
> Статус: Канонічна специфікація
> Мова: Українська (канонічна)

---

## КОНТЕКСТ

Garden Bloom проєктується як **personal/team knowledge platform**, де масштабування відбувається вглибину (більше агентів, складніша логіка, більше знань) — а не вшир (мільйони користувачів). Модель масштабування відповідає цьому профілю використання.

---

## ПРОБЛЕМА

Відсутність explicit scaling model призводить до:
- Невизначеності у виборі deployment configuration для Agent Service
- Відсутності меж для кількості одночасних агентів/runs
- Немає basis для рішень про шардування storage

---

## РІШЕННЯ

### Цільові масштаби (Design Points)

| Вимір | MVP (зараз) | Target V1 | Ceiling |
|-------|-------------|-----------|---------|
| Агентів у системі | 1–10 | 10–50 | 200 |
| Одночасних runs | 1 | 3–5 | 20 |
| Runs per day | 5–20 | 50–200 | 1 000 |
| Proposals per day | 5–50 | 100–500 | 5 000 |
| MinIO storage | < 1 GB | 1–10 GB | 100 GB |
| Users (Owner) | 1 | 1 | 1 (single-owner design) |
| Zone Guests per day | 1–10 | 10–100 | 1 000 |

### Concurrency model

**[РІШЕННЯ]** Default concurrency: **1 run per agent** (Orchestration Layer enforces).

```
При надходженні нового run request для агента A:
  IF agent_A_running:
    → queued (max queue depth: 5 per agent)
    → якщо queue повний: reject з 429
  ELSE:
    → execute immediately
```

**[РІШЕННЯ]** Global concurrent runs: **max 10** (cross-agent). При перевищенні — FIFO queue.

### Storage scaling

| Component | Scaling strategy | Bottleneck |
|-----------|-----------------|------------|
| **MinIO** | Vertical scaling (більший диск) | I/O на self-hosted сервері |
| **git monorepo** (memory) | Horizontal: окремий repo per agent при > 500 MB | git clone latency |
| **Cloudflare KV** | Cloudflare manages | KV throughput limits |
| **Cloudflare Worker** | Auto-scales | Worker CPU time limits |

### Agent Service scaling

**[ПРИНЦИП]** Agent Service (Mastra + Orchestration Layer) є stateless стосовно агентних runs. Горизонтальне масштабування можливе без coordination overhead.

```
Single instance (MVP):
  Agent Service × 1 → handles all runs sequentially per agent

Scaled instance:
  Agent Service × N → Orchestration Layer distributes runs across instances
  Shared: MinIO (canonical), git monorepo (memory)
  Local: in-flight run state (ефемерний)
```

**[ОБМЕЖЕННЯ]** Поточний design для single-owner. Multi-tenancy вимагає окремого архітектурного рішення.

### Gateway (Cloudflare Worker) scaling

Worker автомасштабується Cloudflare. Bottleneck — не Worker, а:
- MinIO throughput (self-hosted)
- NotebookLM rate limits (browser automation)

---

## ІНВАРІАНТИ

**SCALE-INV-001:** Система зберігає коректність при будь-якій кількості runs в межах Design Point ceiling — завдяки Orchestration Layer concurrency control.

**SCALE-INV-002:** Горизонтальне масштабування Agent Service не змінює canonical storage semantics. MinIO залишається єдиним source of truth незалежно від кількості Agent Service instances.

**SCALE-INV-003:** NotebookLM є non-scalable bottleneck за замовчуванням (single browser session). При необхідності scale: pool of NLM sessions, кожна з окремим FastAPI endpoint.

---

## ЗВ'ЯЗКИ

**Цей документ залежить від:**
- [[exodus.pp.ua/architecture/foundation/АРХІТЕКТУРНИЙ_КОРІНЬ\|АРХІТЕКТУРНИЙ_КОРІНЬ]] — A1 (storage authority), A3 (stateless runtime), A4 (replaceable orchestration)
- [[exodus.pp.ua/architecture/core/КАНОНІЧНА_АРХІТЕКТУРА_ВИКОНАННЯ\|КАНОНІЧНА_АРХІТЕКТУРА_ВИКОНАННЯ]] — deployment topology §5
- [[exodus.pp.ua/architecture/core/АБСТРАКЦІЯ_РІВНЯ_ОРКЕСТРАЦІЇ\|АБСТРАКЦІЯ_РІВНЯ_ОРКЕСТРАЦІЇ]] — concurrency control capabilities

**Цей документ впливає на:**
- [[exodus.pp.ua/architecture/non-functional/МОДЕЛЬ_НАДІЙНОСТІ\|МОДЕЛЬ_НАДІЙНОСТІ]] — failure modes при scale
- [[exodus.pp.ua/architecture/non-functional/МОДЕЛЬ_ВАРТОСТІ\|МОДЕЛЬ_ВАРТОСТІ]] — cost at different design points

---

*Цей документ визначає scaling model для Garden Bloom як single-owner knowledge platform.*
