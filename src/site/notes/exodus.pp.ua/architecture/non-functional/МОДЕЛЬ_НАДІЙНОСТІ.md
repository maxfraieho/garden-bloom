---
{"tags":["domain:arch","status:canonical","format:spec","feature:execution"],"created":"2026-02-22","updated":"2026-02-22","tier":1,"title":"МОДЕЛЬ НАДІЙНОСТІ","dg-publish":true,"dg-metatags":null,"dg-home":null,"permalink":"/exodus.pp.ua/architecture/non-functional/МОДЕЛЬ_НАДІЙНОСТІ/","dgPassFrontmatter":true,"noteIcon":""}
---


# МОДЕЛЬ_НАДІЙНОСТІ

> Створено: 2026-02-22
> Автор: Головний архітектор системи
> Статус: Канонічна специфікація
> Мова: Українська (канонічна)

---

## КОНТЕКСТ

Garden Bloom зберігає знання, які є цінністю власника системи. Надійність системи вимірюється не uptime сервісів, а **цілісністю canonical storage** (MinIO + git monorepo). Сервіси можуть падати — знання не повинні губитися.

Ця асиметрія є архітектурним рішенням: A1 (storage is canonical), A3 (runtime is stateless). Runtime failure є recoverable; storage failure є catastrophic.

---

## ПРОБЛЕМА

Відсутність explicit reliability model призводить до:
- Нерозуміння failure modes системи
- Відсутності recovery playbooks
- Нечітких SLA для кожного компонента

---

## РІШЕННЯ

### Reliability tier кожного компонента

| Компонент | Criticality | Failure impact | Recovery |
|-----------|-------------|----------------|----------|
| **MinIO** | CRITICAL | Втрата canonical state | Backup restore |
| **git monorepo** (memory) | CRITICAL | Втрата agent memory | git clone від останнього backup |
| **Cloudflare Worker** | HIGH | Система недоступна | Cloudflare auto-restart; ~0 downtime |
| **Hatchet (Orchestration)** | MEDIUM | Runs не запускаються; proposals не обробляються | Restart; pending runs replay |
| **Mastra (Runtime)** | MEDIUM | Agent logic не виконується | Restart; next run clean start |
| **FastAPI (NLM proxy)** | LOW | NLM tool unavailable; agent falls back або fails step | Restart; no state loss |
| **Frontend** | LOW | UI недоступний; system continues | Browser refresh |

### Failure scenarios та recovery

#### Scenario 1: Mastra/Agent Service crash під час run

```
Run state: running (step 2/4)
Failure: Agent Service process exits

Orchestration Layer detects: step timeout or process failure
Action: mark step as failed
Orchestration Layer: retry step від початку (або від останнього checkpoint)
Result: run continues; prior step results preserved in MinIO

[ІНВАРІАНТ] Mastra stateless → retry не потребує state recovery
```

#### Scenario 2: MinIO недоступний під час write

```
Run state: step 3 (proposal write)
Failure: MinIO S3 API timeout

Orchestration Layer: retry з exponential backoff (3 attempts)
If all retries fail:
  → step → failed
  → run → failed (не completed)
  → status.json updated: {status: "failed", reason: "storage_unavailable"}

Owner action required: retry run або investigate MinIO
```

#### Scenario 3: Orchestration Layer restart з in-flight runs

```
Runs in state: running, queued
Failure: Hatchet restart

Durable execution replay: Hatchet reads its durable execution log
Pending runs: re-queued
In-progress runs: replay від останнього completed step
Result: runs continue; no manual intervention needed

[ЗАЛЕЖНІСТЬ] Вимагає durable execution у Orchestration Layer (A4 invariant)
```

#### Scenario 4: NotebookLM session expired

```
Agent mid-execution: calls notebooklm-query tool
Failure: NLM session expired (browser automation)

FastAPI: returns 503
Mastra tool: throws NLMUnavailableError
Agent: step fails

Orchestration Layer: retry step (якщо retry policy дозволяє)
FastAPI: re-authenticate NLM session automatically (якщо implemented)

Mitigation: FastAPI health check перевіряє NLM session before каждного запиту
```

### Backup strategy для critical components

| Component | Backup method | RPO | RTO |
|-----------|--------------|-----|-----|
| **MinIO** | Daily snapshot до external storage | 24 hours | 1–4 hours |
| **git monorepo** (memory) | git push до GitHub mirror | Continuous | Minutes |
| **Cloudflare KV** (zones, auth) | Export via API weekly | 7 days | Hours |

### Consecutive failure threshold

**[РІШЕННЯ]** Агент переходить у стан `error` (не може запускатись) при:
- 3 consecutive failed runs
- Admin action потрібна для reset

```json
{
  "agent_status": "error",
  "reason": "consecutive_failures",
  "failed_runs": 3,
  "last_failure": "2026-02-22T10:00:00Z",
  "recovery": "Owner must reset agent status"
}
```

---

## ІНВАРІАНТИ

**REL-INV-001:** Втрата runtime state (Mastra, Orchestration Layer) є recoverable. Втрата canonical state (MinIO, git) є catastrophic. Backup strategy для critical components — обов'язкова.

**REL-INV-002:** Partial write до canonical storage заборонений. Apply Engine використовує atomic write pattern: або все записано, або нічого. Proposal переходить у `failed` при будь-якій частковій помилці.

**REL-INV-003:** status.json є eventual consistent (записується Orchestration Layer wrapper, не Mastra). Owner UI polling — accepted consistency model.

---

## ЗВ'ЯЗКИ

**Цей документ залежить від:**
- [[exodus.pp.ua/architecture/foundation/АРХІТЕКТУРНИЙ_КОРІНЬ\|АРХІТЕКТУРНИЙ_КОРІНЬ]] — A1 (storage canonical), A3 (stateless runtime), A4 (durable execution)
- [[exodus.pp.ua/architecture/historical/АРХІТЕКТУРНИЙ_АУДИТ_ТА_УЗГОДЖЕНІСТЬ_ФІНАЛЬНИЙ\|АРХІТЕКТУРНИЙ_АУДИТ_ТА_УЗГОДЖЕНІСТЬ_ФІНАЛЬНИЙ]] — failure scenarios §4.1
- [[exodus.pp.ua/architecture/core/КАНОНІЧНИЙ_ЦИКЛ_ЗАПУСКУ\|КАНОНІЧНИЙ_ЦИКЛ_ЗАПУСКУ]] — state machine при failures
- [[exodus.pp.ua/architecture/core/АБСТРАКЦІЯ_РІВНЯ_ОРКЕСТРАЦІЇ\|АБСТРАКЦІЯ_РІВНЯ_ОРКЕСТРАЦІЇ]] — retry/durability capabilities

**Цей документ впливає на:**
- [[exodus.pp.ua/architecture/non-functional/БЕЗПЕКА_СИСТЕМИ\|БЕЗПЕКА_СИСТЕМИ]] — availability as security property
- [[exodus.pp.ua/architecture/non-functional/МОДЕЛЬ_СПОСТЕРЕЖУВАНОСТІ\|МОДЕЛЬ_СПОСТЕРЕЖУВАНОСТІ]] — що алертувати при failures

---

*Цей документ визначає reliability model Garden Bloom: canonical storage is sacred, runtime is replaceable.*
