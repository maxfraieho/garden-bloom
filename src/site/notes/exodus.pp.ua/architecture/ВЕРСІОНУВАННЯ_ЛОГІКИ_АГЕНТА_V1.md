---
{"tags":["domain:agent","status:canonical","format:spec","feature:logic"],"created":"2026-02-21","updated":"2026-02-21","tier":1,"title":"ВЕРСІОНУВАННЯ_ЛОГІКИ_АГЕНТА_V1","dg-publish":true,"dg-metatags":null,"dg-home":null,"permalink":"/exodus.pp.ua/architecture/ВЕРСІОНУВАННЯ_ЛОГІКИ_АГЕНТА_V1/","dgPassFrontmatter":true,"noteIcon":""}
---

# AGENT_LOGIC_VERSIONING_V1

**Статус:** Канонічний  
**Версія:** 1.0.0  
**Дата:** 2026-02-17  
**Автор:** Головний архітектор, Garden Bloom  
**Розташування:** `docs/architecture/ВЕРСІОНУВАННЯ_ЛОГІКИ_АГЕНТА_V1.md`  
**Мова:** Українська (технічна)  
**Залежить від:** `docs/architecture/ПАМ_ЯТЬ_АГЕНТА_GIT_DIFFMEM_V1.md` (v1.1.0+)

---

> **Незмінний інваріант:** Цей документ є частиною канонічної документації рантайму.  
> Він НЕ посилається на `archive/`, НЕ містить посилань на Inngest або gh-aw.  
> Архітектура є вендор-агностичною.

---

## ЗМІСТ

1. [Концепція та мотивація](#секція-1--концепція-та-мотивація)
2. [Структура файлів логіки агента](#секція-2--структура-файлів-логіки-агента)
3. [Модель версіонування логіки](#секція-3--модель-версіонування-логіки)
4. [Агент-оптимізатор](#секція-4--агент-оптимізатор)
5. [Інструменти роботи з логікою](#секція-5--інструменти-роботи-з-логікою)
6. [Proposal lifecycle для змін логіки](#секція-6--proposal-lifecycle-для-змін-логіки)
7. [Людський аудит еволюції логіки](#секція-7--людський-аудит-еволюції-логіки)
8. [Модель безпеки](#секція-8--модель-безпеки)
9. [Інтеграція з існуючою архітектурою](#секція-9--інтеграція-з-існуючою-архітектурою)
10. [Фінальна рекомендація](#секція-10--фінальна-рекомендація)

---

## СЕКЦІЯ 1 — Концепція та мотивація

### 1.1 Проблема

У поточній архітектурі Garden Bloom **знання агента** (facts, snapshot) версіонуються через git-пам'ять. Але **логіка агента** — DRAKON-схеми та псевдокод — є статичними артефактами. Вони змінюються вручну людиною і не мають механізму:

- систематичного відстеження того, як зміна логіки впливає на результати
- автоматичного виявлення неефективних або помилкових патернів поведінки
- пропонування покращень на основі аналізу реальних запусків

### 1.2 Ключова ідея

Якщо **знання** агента можуть еволюціонувати через git-коміти та Proposals, то **логіка** агента може еволюціонувати так само. Кожна версія DRAKON-схеми — це git-коміт. Кожна зміна — це Proposal, який обґрунтований аналізом реальних `runs/`.

Це відповідає тому, як працює людський мозок: досвід (runs) змінює не тільки знання (facts), але й **патерни поведінки** (logic). Різниця — у повній аудитабельності та зворотності кожної зміни.

### 1.3 Аналогія: нейропластичність з git-логом

```
Мозок людини:
  досвід → синаптичне підсилення/послаблення → зміна поведінки
  (непрозоро, незворотньо, без версій)

Garden Bloom:
  runs/ → аналіз оптимізатором → Proposal на зміну logic/ → git-коміт
  (прозоро, зворотньо, з повною версійністю)
```

Це є **верифікована нейропластичність**: кожне «навчання» задокументоване, кожна зміна — оборотна.

### 1.4 Системні вимоги

Архітектура версіонування логіки **зобов'язана**:

- зберігати повну версійну історію всіх DRAKON-схем і псевдокоду
- забезпечити людський контроль над кожною зміною логіки (Proposal lifecycle)
- дозволити порівняння результативності різних версій логіки
- не вводити баз даних або vendor-специфічних залежностей
- залишатись у межах канонічної файл-базованої архітектури

---

## СЕКЦІЯ 2 — Структура файлів логіки агента

### 2.1 Повна структура директорій

```
logic/
  <agentId>/
    current.drakon.json     ← поточна DRAKON-схема (машинний формат)
    current.pseudo.md       ← поточний псевдокод (читабельний)
    current.meta.json       ← метадані поточної версії
    changelog.md            ← хронологія змін логіки
    versions/
      v001.drakon.json      ← заморожена версія (тільки git-history для читання)
      v001.pseudo.md
      v001.meta.json
      v001.rationale.md     ← чому було прийнято цю версію
```

> **Важливо:** `versions/` є **read-only архівом** для людського аудиту.  
> Рантайм і агент-оптимізатор читають тільки `current.*`.  
> `versions/` не завантажується автоматично в контекст агента.

---

### 2.2 Опис кожного файлу

#### `current.drakon.json`

**Призначення:** Поточна активна DRAKON-схема агента у машинному форматі. Це єдиний файл, який рантайм завантажує для розуміння логіки виконання.

**Формат:** JSON-серіалізація DRAKON-діаграми (сумісна з drakonwidget/drakongen).

**Частота запису:** При кожному затвердженому Proposal на зміну логіки.  
**Власник:** Proposal lifecycle (тільки через Gateway).  
**Розмір:** Визначається складністю схеми; рекомендовано ≤ 50 KB.  
**Утримання:** Постійно (поточна версія); попередні → `versions/`.

---

#### `current.pseudo.md`

**Призначення:** Людиночитабельний псевдокод поточної логіки агента. Генерується з `current.drakon.json` через drakongen або пишеться людиною паралельно зі схемою. Є основним документом для розуміння поведінки агента без спеціального ПЗ.

**Формат:**
```markdown
# Псевдокод: <agentId>
**Версія логіки:** v007
**Оновлено:** 2026-02-17T14:30:00Z
**На основі Proposal:** proposal_logic_xyz

## Головний потік

1. ПОЧАТОК
2. read-memory(mode=basic)
3. ЯКЩО snapshot.version < поточна → оновити контекст
4. Виконати основну задачу
5. ЯКЩО нові факти виявлено:
   → propose-memory-update(facts)
6. ЯКЩО логіка дала збій (error_rate > threshold):
   → позначити в runs/run_<id>.md: "logic_issue: true"
7. КІНЕЦЬ

## Допоміжні блоки

### Блок: оцінка якості відповіді
...
```

**Частота запису:** При кожній зміні логіки.  
**Власник:** Proposal lifecycle.  
**Розмір:** ≤ 8 000 токенів.  
**Утримання:** Постійно (поточна версія); попередні → `versions/`.

---

#### `current.meta.json`

**Призначення:** Метадані поточної версії логіки: номер версії, дата, Proposal-джерело, кількість запусків на цій версії, агрегована статистика.

**Формат:**
```json
{
  "agentId": "<agentId>",
  "logicVersion": "v007",
  "activeSince": "2026-02-10T09:00:00Z",
  "sourceProposal": "proposal_logic_xyz",
  "runsOnThisVersion": 143,
  "successRate": 0.94,
  "avgTokensPerRun": 3200,
  "optimizerLastAnalysis": "2026-02-17T08:00:00Z",
  "optimizerRecommendation": "none",
  "schemaVersion": "1.0"
}
```

**Частота запису:** При кожному запуску (інкрементально: `runsOnThisVersion++`).  
**Власник:** Gateway (автоматично при кожному run-завершенні).  
**Розмір:** < 500 байт.  
**Утримання:** Постійно.

---

#### `changelog.md`

**Призначення:** Хронологічний журнал змін логіки агента з поясненнями. Дозволяє людині швидко зрозуміти еволюцію поведінки агента.

**Формат:**
```markdown
# Logic Changelog: <agentId>

## v007 — 2026-02-10
**Proposal:** proposal_logic_xyz  
**Ініціатор:** агент-оптимізатор  
**Причина:** runs 98-112 показали помилковий branch при порожньому snapshot  
**Зміна:** додано перевірку `snapshot.version != null` перед головним потоком  
**Результат після 143 запусків:** success_rate 0.87 → 0.94  

## v006 — 2026-01-28
...
```

**Частота запису:** При кожній зміні логіки.  
**Власник:** Gateway (автоматично).  
**Розмір:** Накопичується; завантажується тільки останні 10 записів.  
**Утримання:** Постійно.

---

#### `versions/v<NNN>.*`

**Призначення:** Заморожені копії попередніх версій логіки для аудиту та порівняння. Три файли на версію: `.drakon.json`, `.pseudo.md`, `.meta.json`.

**Додатково — `versions/v<NNN>.rationale.md`:** Обґрунтування: чому ця версія була прийнята, що вона мала виправити, і які були результати.

**Формат `rationale.md`:**
```markdown
# Rationale: <agentId> v007

## Проблема, яку вирішувала ця версія
Runs 98-112: агент падав у нескінченний цикл при порожньому snapshot.
Error rate: 13% (15 з 112 runs).

## Запропонована зміна
Агент-оптимізатор: додати guard-clause на початку головного потоку.

## Результат
Runs 113-255: error rate 0.6% (1 з 143 runs).

## Порівняння з v006
| Метрика | v006 | v007 |
|---|---|---|
| success_rate | 0.87 | 0.94 |
| avg_tokens | 3800 | 3200 |
| error_rate | 0.13 | 0.006 |
```

**Частота запису:** Один раз при архівації попередньої версії.  
**Власник:** Gateway (автоматично при застосуванні нового logic-Proposal).  
**Утримання:** Постійно (незмінний архів).

---

## СЕКЦІЯ 3 — Модель версіонування логіки

### 3.1 Lifecycle версії логіки

```
[Поточна логіка: v006, активна]
         ↓
[Агент-оптимізатор аналізує runs/]
         ↓
[Формує Proposal: logic-update]
         ↓
[Людина переглядає diff між v006 і proposed]
         ↓
[Затверджує Proposal]
         ↓
Gateway виконує:
  1. Копіює current.* → versions/v006.*
  2. Записує versions/v006.rationale.md
  3. Записує нові current.* (v007)
  4. Оновлює current.meta.json
  5. Додає запис у changelog.md
  6. Git-коміт: "logic-update: <agentId> v006→v007 / proposal_logic_xyz"
         ↓
[Поточна логіка: v007, активна]
```

### 3.2 Нумерація версій

Версії логіки нумеруються послідовно: `v001`, `v002`, ... `v999`.

Це відрізняється від semver навмисно: зміни логіки агента не є «breaking» або «minor» у класичному розумінні — кожна зміна є результатом аналізу реальних runs і є рівнозначно важливою.

### 3.3 Заморожена версія — незмінна

Файли в `versions/` є **незмінними після запису**. Жоден Proposal не може модифікувати архівні версії. Це є гарантією аудитабельності.

### 3.4 Rollback логіки

Якщо нова версія логіки дає гірші результати, людина може виконати rollback:

```
Метод 1 (через Proposal):
  Людина формує Proposal із вмістом versions/v006.*
  Gateway застосовує → current.* = v006 → нова версія v008 (копія v006)
  changelog.md: "v008 — rollback до v006"

Метод 2 (через git):
  git revert <commit-hash-v007>
  Gateway детектує зміну → оновлює current.meta.json
```

Rollback **не видаляє** v007 з git-history. Він лише робить v008 = змістовна копія v006.

---

## СЕКЦІЯ 4 — Агент-оптимізатор

### 4.1 Концепція

Агент-оптимізатор — це **окремий спеціалізований агент**, єдина задача якого: аналізувати результати запусків інших агентів і пропонувати зміни в їхній логіці. Він не виконує жодних операцій крім читання та формування Proposals.

Назва (приклад): `optimizer` або `logic-reviewer`.

### 4.2 Файлова структура агента-оптимізатора

```
memory/optimizer/
  snapshot.md         ← поточні задачі оптимізатора
  facts.md            ← накопичені патерни неефективності

logic/optimizer/
  current.pseudo.md   ← логіка аналізу (сама теж версіонується!)
```

> **Рекурсивна властивість:** Агент-оптимізатор має власну логіку, яка також може бути оптимізована — людиною або іншим агентом-метаоптимізатором.

### 4.3 Алгоритм роботи оптимізатора

```
Запуск агента-оптимізатора (тригер: розклад або manual):

ВХІДНІ ДАНІ:
  - logic/<targetAgentId>/current.pseudo.md
  - logic/<targetAgentId>/current.meta.json
  - logic/<targetAgentId>/changelog.md (останні 5 записів)
  - runs/<targetAgentId>/ (останні N запусків, Шар 2)
    → завантажуються ТІЛЬКИ тут, за явним запитом

АНАЛІЗ:
  1. Зчитати current.meta.json:
     → success_rate, avg_tokens, runsOnThisVersion
  2. ЯКЩО success_rate < threshold_success (наприклад, 0.90):
     → аналізувати runs з logic_issue: true
  3. ЯКЩО avg_tokens > threshold_tokens (наприклад, 5 000):
     → аналізувати runs з найбільшим споживанням токенів
  4. Знайти патерни: які кроки у pseudo.md корелюють зі збоями?
  5. Порівняти з changelog.md: чи ця проблема вже траплялась?

ВИВІД:
  ЯКЩО знайдено проблему і є пропозиція виправлення:
    → propose-logic-update(targetAgentId, proposed_changes, rationale)
  ЯКЩО проблем не виявлено:
    → записати в memory/optimizer/facts.md: "агент X в нормі на v007"
  ЯКЩО виявлено патерн без чіткого рішення:
    → записати в memory/optimizer/open_loops.md: "аномалія в агенті X"
```

### 4.4 Що оптимізатор МОЖЕ пропонувати

- Додати guard-clause в псевдокод (перевірку умови на початку потоку)
- Змінити порядок кроків
- Видалити надлишковий крок (що не впливає на результат але витрачає токени)
- Додати або змінити threshold-значення
- Спростити розгалуження

### 4.5 Що оптимізатор НЕ може робити

- Вносити зміни в логіку без Proposal (порушення Інваріанту 3)
- Читати `memory/<agentId>/` інших агентів без явного дозволу (ізоляція пам'яті)
- Модифікувати `versions/` (незмінний архів)
- Запускати агента безпосередньо (оптимізатор — аналітик, не оркестратор)

### 4.6 Псевдо-JSON Proposal від оптимізатора

```json
{
  "type": "logic-update",
  "targetAgentId": "garden-bloom-curator",
  "optimizerRunId": "run_opt_789",
  "currentVersion": "v006",
  "proposedChanges": {
    "current.pseudo.md": {
      "operation": "patch",
      "diff": "--- current.pseudo.md\n+++ proposed.pseudo.md\n@@ -3,6 +3,9 @@\n+3. ЯКЩО snapshot.version == null → завершити з помилкою\n ..."
    },
    "current.drakon.json": {
      "operation": "replace",
      "content": "<нова JSON-схема>"
    }
  },
  "rationale": {
    "problem": "Runs 98-112: 13% error rate при порожньому snapshot",
    "evidence": ["run_098", "run_103", "run_112"],
    "expectedImprovement": "error_rate < 1%",
    "riskAssessment": "low — додається guard clause без зміни основного потоку"
  },
  "priority": "normal",
  "requiresHumanReview": true
}
```

> **Примітка:** Proposals типу `logic-update` **завжди** мають `requiresHumanReview: true`.  
> Зміни в логіці агента ніколи не застосовуються автоматично — тільки після  
> свідомого перегляду людиною diff між поточною і запропонованою схемою.

---

## СЕКЦІЯ 5 — Інструменти роботи з логікою

### 5.1 `read-logic()`

**Призначення:** Читання поточної логіки агента рантаймом.

**Псевдо-JSON запит:**
```json
{
  "tool": "read-logic",
  "agentId": "garden-bloom-curator",
  "format": "pseudo",
  "maxTokens": 4000
}
```

**Псевдо-JSON відповідь:**
```json
{
  "agentId": "garden-bloom-curator",
  "logicVersion": "v007",
  "format": "pseudo",
  "tokenCount": 2100,
  "content": "<зміст current.pseudo.md>",
  "meta": {
    "activeSince": "2026-02-10T09:00:00Z",
    "runsOnThisVersion": 143,
    "successRate": 0.94
  }
}
```

### 5.2 `propose-logic-update()`

**Призначення:** Формування Proposal на зміну логіки. Може ініціюватись агентом-оптимізатором або людиною.

**Псевдо-JSON запит:**
```json
{
  "tool": "propose-logic-update",
  "targetAgentId": "garden-bloom-curator",
  "optimizerRunId": "run_opt_789",
  "proposedPseudo": "<новий псевдокод>",
  "proposedDrakon": "<нова DRAKON-схема JSON>",
  "rationale": "...",
  "evidenceRuns": ["run_098", "run_103"],
  "requiresHumanReview": true
}
```

### 5.3 `logic-diff()`

**Призначення:** Порівняння двох версій логіки агента. Використовується людиною при перегляді Proposal.

**Псевдо-JSON запит:**
```json
{
  "tool": "logic-diff",
  "agentId": "garden-bloom-curator",
  "fromVersion": "v006",
  "toVersion": "proposed",
  "format": "pseudo"
}
```

**Псевдо-JSON відповідь:**
```json
{
  "agentId": "garden-bloom-curator",
  "fromVersion": "v006",
  "toVersion": "proposed",
  "diff": "--- v006/current.pseudo.md\n+++ proposed/current.pseudo.md\n@@ ...",
  "summary": "+3 рядки, -1 рядок, змінено: guard clause на початку потоку",
  "riskLevel": "low"
}
```

### 5.4 `logic-performance()`

**Призначення:** Отримання агрегованої статистики по версіях логіки. Використовується оптимізатором та людиною для оцінки ефективності змін.

**Псевдо-JSON запит:**
```json
{
  "tool": "logic-performance",
  "agentId": "garden-bloom-curator",
  "versions": ["v005", "v006", "v007"],
  "metrics": ["success_rate", "avg_tokens", "error_rate"]
}
```

**Псевдо-JSON відповідь:**
```json
{
  "agentId": "garden-bloom-curator",
  "versions": {
    "v005": { "success_rate": 0.82, "avg_tokens": 4200, "error_rate": 0.18, "totalRuns": 89 },
    "v006": { "success_rate": 0.87, "avg_tokens": 3800, "error_rate": 0.13, "totalRuns": 112 },
    "v007": { "success_rate": 0.94, "avg_tokens": 3200, "error_rate": 0.006, "totalRuns": 143 }
  },
  "trend": "improving",
  "recommendation": "v007 стабільно краща — продовжувати"
}
```

---

## СЕКЦІЯ 6 — Proposal lifecycle для змін логіки

### 6.1 Специфіка logic-update Proposal

Proposals типу `logic-update` проходять той самий lifecycle, що і всі інші Proposals в системі:

```
pending → approved/rejected → applying → applied/failed
```

Але мають **обов'язкові додаткові вимоги**:

| Поле | Вимога |
|---|---|
| `requiresHumanReview` | Завжди `true` — без виключень |
| `rationale.evidenceRuns` | Мінімум 1 посилання на реальний run |
| `logic-diff()` | Повинен бути показаний людині при перегляді |
| `auto-approve` | Заборонено для `logic-update` |

### 6.2 Що відбувається при `applying`

Gateway при застосуванні `logic-update` Proposal виконує:

```
1. Валідує JSON-структуру нової DRAKON-схеми
2. Генерує псевдокод (якщо не надано явно) через drakongen
3. Копіює current.* → versions/v<N>.*
4. Записує versions/v<N>.rationale.md із вмістом Proposal.rationale
5. Записує нові current.drakon.json та current.pseudo.md
6. Оновлює current.meta.json (logicVersion++, runsOnThisVersion=0)
7. Додає запис у changelog.md
8. Git-коміт: "logic-update: <agentId> v<N>→v<N+1> / <proposalId>"
```

### 6.3 Відхилення Proposal людиною

Людина може відхилити Proposal з кількох причин:

- Зміна надто радикальна (зачіпає основний потік без достатнього обґрунтування)
- Недостатньо доказів (малий розмір вибірки runs)
- Запропонований псевдокод некоректний або нечитабельний
- Краще рішення вже відоме людині

При відхиленні оптимізатор отримує статус `rejected` і причину — що дозволяє йому навчитись і запропонувати краще рішення наступного разу (через зміну власної логіки).

---

## СЕКЦІЯ 7 — Людський аудит еволюції логіки

### 7.1 Перегляд поточної логіки

```bash
# Читабельний псевдокод
cat logic/<agentId>/current.pseudo.md

# Метадані поточної версії
cat logic/<agentId>/current.meta.json

# Хронологія змін
cat logic/<agentId>/changelog.md
```

### 7.2 Порівняння версій

```bash
# Diff між v006 і v007
diff logic/<agentId>/versions/v006.pseudo.md logic/<agentId>/current.pseudo.md

# Чому v007 була прийнята?
cat logic/<agentId>/versions/v007.rationale.md

# Повна git-хронологія змін логіки
git log --oneline logic/<agentId>/
```

### 7.3 Трасування: погіршення результатів → причина

```
1. Людина помічає: success_rate впав після 2026-02-10
   ↓
2. logic/<agentId>/current.meta.json → activeSince: 2026-02-10 = v007
   ↓
3. logic/<agentId>/changelog.md → v007: "додано guard clause"
   ↓
4. logic/<agentId>/versions/v007.rationale.md → evidenceRuns: [run_098...]
   ↓
5. memory/<agentId>/runs/run_098.md → деталі конкретного збою
   ↓
6. Людина приймає рішення: rollback до v006 або виправлення v007
```

### 7.4 Відображення в Garden Bloom UI (майбутнє)

Розділ «Логіка агентів» повинен показувати:

- Поточну версію логіки та її статистику
- Графік `success_rate` по версіях (trend chart)
- Pending Proposals від оптимізатора з diff-переглядом
- Кнопку «Rollback до v<N>»

---

## СЕКЦІЯ 8 — Модель безпеки

### 8.1 Загрози специфічні для logic-versioning

#### Загроза: Маніпуляція логікою через Proposal

**Опис:** Зловмисний або некоректний Proposal може замінити логіку агента шкідливою схемою.

**Пом'якшення:**
- `requiresHumanReview: true` для всіх logic-update — людина завжди в контурі.
- Gateway валідує JSON-структуру DRAKON-схеми перед застосуванням.
- Git-коміт незмінний: будь-яка маніпуляція видима в log.
- Rollback доступний за лічені хвилини.

#### Загроза: Оптимізатор пропонує деградуючі зміни

**Опис:** Агент-оптимізатор може неправильно інтерпретувати runs і запропонувати зміну, що погіршує логіку.

**Пом'якшення:**
- `requiresHumanReview: true` — людина переглядає diff.
- `rationale.evidenceRuns` — людина може перевірити конкретні runs.
- `logic-performance()` — порівняння статистики до/після.
- Rollback: якщо нова версія гірша, rollback через Proposal за 1 хвилину.

#### Загроза: Нескінченний цикл оптимізації

**Опис:** Оптимізатор пропонує зміну → версія гірша → оптимізатор пропонує відкат → ... і так по колу.

**Пом'якшення:**
- Оптимізатор перевіряє `changelog.md`: чи подібна зміна вже пробувалась?
- Якщо так — позначає як `open_loop` замість нового Proposal.
- Людина вирішує ситуацію вручну.

### 8.2 Матриця ризиків

| Загроза | Ймовірність | Вплив | Пом'якшення | Залишковий ризик |
|---|---|---|---|---|
| Маніпуляція логікою | Низька | Критичний | Human review + git rollback | Мінімальний |
| Деградуючі зміни | Середня | Середній | Human review + performance metrics | Низький |
| Цикл оптимізації | Низька | Низький | changelog check + open_loop | Мінімальний |
| Пошкодження схеми | Низька | Середній | JSON validation + git rollback | Мінімальний |

---

## СЕКЦІЯ 9 — Інтеграція з існуючою архітектурою

### 9.1 Розширена структура монорепозиторію

Монорепозиторій `garden-bloom-memory` (визначений в ПАМ_ЯТЬ_АГЕНТА_GIT_DIFFMEM_V1.md) розширюється:

```
garden-bloom-memory/
  memory/                    ← пам'ять агентів (визначено в V1)
    <agentId>/
      snapshot.md
      facts.md
      ...
  logic/                     ← логіка агентів (новий розділ)
    <agentId>/
      current.drakon.json
      current.pseudo.md
      current.meta.json
      changelog.md
      versions/
        ...
  .git/
```

Обидва розділи (`memory/` і `logic/`) є частиною одного git-репозиторію, що дозволяє єдиний git log для аудиту як знань, так і логіки агентів.

### 9.2 Нові Proposal-типи в Gateway

Gateway розширюється підтримкою нових типів Proposals:

| Тип | Опис | auto-approve |
|---|---|---|
| `memory-update` | Оновлення знань агента | Можливо (normal priority) |
| `logic-update` | Зміна логіки агента | Заборонено — завжди human review |
| `logic-rollback` | Відкат до попередньої версії логіки | Заборонено — завжди human review |

### 9.3 Нові ендпоінти Gateway

```
GET  /logic/:agentId/read            → read-logic()
POST /logic/:agentId/propose         → propose-logic-update()
GET  /logic/:agentId/diff?from=&to=  → logic-diff()
GET  /logic/:agentId/performance     → logic-performance()
```

### 9.4 Взаємодія пам'ять ↔ логіка

Пам'ять і логіка агента є **незалежними але взаємопов'язаними**:

```
memory/<agentId>/facts.md    ← агент знає ЩО
logic/<agentId>/current.pseudo.md ← агент знає ЯК діяти

Оптимізатор читає обидва:
  "агент знає правильні факти, але діє неефективно" → logic-update
  "агент діє правильно, але має застарілі факти" → memory-update
```

### 9.5 Збереження системних інваріантів

| Інваріант | Статус |
|---|---|
| 1. Файл-базоване сховище | ✅ git + Markdown |
| 2. Gateway — єдина точка мутацій | ✅ Усі logic-write через Gateway |
| 3. Proposal lifecycle обов'язковий | ✅ logic-update завжди через Proposal |
| 4. Runtime stateless | ✅ Рантайм тільки читає logic/ |
| 5. Runtime не пише canonical storage | ✅ |
| 7. Vendor-agnostic | ✅ JSON API, Markdown, git |
| 8. docs/ канонічний корінь | ✅ |
| 9. archive/ не використовується | ✅ |
| 10. NotebookLM опціональний | ✅ |

---

## СЕКЦІЯ 10 — Фінальна рекомендація

### 10.1 V1 Канонічний підхід

**Версіонування логіки агентів через `logic/<agentId>/` у монорепозиторії `garden-bloom-memory`, з агентом-оптимізатором як спеціалізованим аналітичним агентом, що пропонує зміни через Proposal lifecycle з обов'язковим людським переглядом.**

### 10.2 Ключові переваги

**Повна верифікованість еволюції.** Кожна зміна поведінки агента має причину (evidenceRuns), автора (оптимізатор або людина), diff (logic-diff) і результат (performance metrics). Це неможливо в класичних ML-системах.

**Безпечна еволюція.** Людина завжди в контурі для змін логіки. Rollback — за лічені хвилини через git. Жодна зміна не є необоротною.

**Рекурсивна властивість.** Логіка оптимізатора сама версіонується і може бути оптимізована. Система може «самовдосконалюватись» на всіх рівнях — але завжди під людським контролем.

**Єдиний репозиторій — єдиний аудит.** `git log garden-bloom-memory/` показує повну хронологію еволюції як знань, так і логіки всіх агентів. Людина бачить систему цілісно.

### 10.3 Порядок впровадження

Версіонування логіки впроваджується **після** стабілізації системи пам'яті (AGENT_MEMORY_GIT_DIFFMEM_V1 Фаза 3+). Рекомендований порядок:

```
Фаза A — Файлова структура logic/ (паралельно з memory Фазою 1)
  Створити logic/<agentId>/ з поточними схемами вручну.

Фаза B — read-logic() та logic-diff() (паралельно з memory Фазою 2)
  Тільки читання. Агент може завантажити власну логіку.

Фаза C — propose-logic-update() від людини (паралельно з memory Фазою 3)
  Людина пропонує зміни через Proposal. Перевірка lifecycle.

Фаза D — Запуск агента-оптимізатора в режимі спостерігача
  Оптимізатор аналізує, але тільки записує в open_loops.md.
  Ще не формує Proposals.

Фаза E — Оптимізатор починає формувати Proposals
  Кожен Proposal — ручний перегляд людиною.
  Поступове накопичення довіри до якості пропозицій.
```

---

## ДОДАТОК — Перевірочний список

| Критерій | Статус |
|---|---|
| Vendor-agnostic | ✅ |
| Без БД | ✅ |
| Proposal lifecycle збережено | ✅ |
| Runtime stateless | ✅ |
| Human-in-the-loop для logic-update | ✅ (обов'язково) |
| Rollback можливий | ✅ |
| Заборонені посилання відсутні | ✅ |
| Сумісно з AGENT_MEMORY_GIT_DIFFMEM_V1 | ✅ |

---

*Документ є канонічним і стає частиною рантайм-архітектури Garden Bloom з моменту публікації.*
*Пов'язані документи: `docs/architecture/ПАМ_ЯТЬ_АГЕНТА_GIT_DIFFMEM_V1.md`*

---

## Семантичні зв'язки

**Цей документ деталізує:**
- [[exodus.pp.ua/architecture/АРХІТЕКТУРНИЙ_КОРІНЬ\|АРХІТЕКТУРНИЙ_КОРІНЬ]] — аксіома A2 (logic-update — завжди через Proposal, завжди human review)

**Цей документ залежить від:**
- [[exodus.pp.ua/architecture/КАНОНІЧНА_МОДЕЛЬ_АВТОРИТЕТУ_СХОВИЩА\|КАНОНІЧНА_МОДЕЛЬ_АВТОРИТЕТУ_СХОВИЩА]] — logic/ storage tier у git monorepo (§1, Tier 3)
- [[exodus.pp.ua/architecture/INBOX_ТА_PROPOSAL_АРХІТЕКТУРА\|INBOX_ТА_PROPOSAL_АРХІТЕКТУРА]] — logic-update Proposal: єдиний механізм зміни логіки
- [[exodus.pp.ua/architecture/DRAKON_ІНТЕГРАЦІЯ_ТА_МОДЕЛЬ_ВИКОНАННЯ_АГЕНТА\|DRAKON_ІНТЕГРАЦІЯ_ТА_МОДЕЛЬ_ВИКОНАННЯ_АГЕНТА]] — DRAKON як canonical format для current.drakon.json

**Від цього документа залежать:**
- [[exodus.pp.ua/architecture/КОНТРАКТ_АГЕНТА_V1\|КОНТРАКТ_АГЕНТА_V1]] — §1.2 logic definition: _agent.md + pseudocode.md з logic/
- [[exodus.pp.ua/architecture/ПАМ_ЯТЬ_АГЕНТА_GIT_DIFFMEM_V1\|ПАМ_ЯТЬ_АГЕНТА_GIT_DIFFMEM_V1]] — суміжний storage tier у тому самому git monorepo
