---
{"tags":["domain:security","status:canonical","format:spec","feature:graph"],"created":"2026-02-21","updated":"2026-02-21","tier":2,"title":"МОДЕЛЬ ДОСТУПУ","dg-publish":true,"dg-metatags":null,"dg-home":null,"permalink":"/exodus.pp.ua/product/МОДЕЛЬ_ДОСТУПУ/","dgPassFrontmatter":true,"noteIcon":""}
---


# Модель доступу Digital Garden

> Статус: Канонічна специфікація
> Мова: Українська (канонічна)

---

## 0. Принцип

**Secure by Default** — сайт закритий без явного доступу.

---

## 1. Рівні доступу

### 1.1 Публічний (без коду)

```
Доступно:
- Сторінка "Необхідний доступ"
- Health check endpoint

Недоступно:
- Контент сайту
- Notes
- Search
- Tags
```

### 1.2 Зональний доступ (код зони)

```
Доступно:
- Notes у зоні
- Пошук по зоні
- Tags у зоні

Недоступно:
- Інші notes
- Панель Owner
- Створення зон
```

### 1.3 Доступ Owner (master-код)

```
Доступно:
- Весь контент
- Управління зонами
- MCP сесії
- Налаштування
```

---

## 2. Потік Access Gate

```
┌──────────────────────────────┐
│        Запит користувача     │
└──────────────────────────────┘
               │
               ▼
┌──────────────────────────────┐
│     Перевірка сесійного      │
│         cookie               │
│  garden_session = valid?     │
└──────────────────────────────┘
               │
      ┌────────┴────────┐
      │                 │
   Дійсний        Немає cookie
      │                 │
      ▼                 ▼
┌──────────┐  ┌──────────────────────┐
│ Дозволити│  │ Показати "Необхідний │
│  доступ  │  │      доступ"         │
└──────────┘  └──────────────────────┘
                         │
                         ▼
              ┌──────────────────────┐
              │  Користувач вводить  │
              │       код:           │
              │  - Master-код        │
              │  - Код зони          │
              └──────────────────────┘
                         │
                         ▼
              ┌──────────────────────┐
              │  Валідація коду      │
              │  POST /auth/login    │
              │  або                 │
              │  GET /zones/validate │
              └──────────────────────┘
                         │
              ┌──────────┴──────────┐
              │                     │
           Дійсний             Недійсний
              │                     │
              ▼                     ▼
   ┌──────────────────┐  ┌──────────────────┐
   │  Встановити      │  │  Показати        │
   │  cookie          │  │  помилку         │
   │  Редирект в app  │  │                  │
   └──────────────────┘  └──────────────────┘
```

---

## 3. Формати кодів

### Master-код

```
Формат: Пароль користувача
Зберігання: Hash у KV (owner:password_hash)
Результат: Full access JWT
```

### Код зони

```
Формат: ZONE-XXXX-YYYY
Зберігання: В об'єкті зони у KV
Результат: Токен обмеженого доступу
Експірація: За налаштуванням зони
```

---

## 4. Зберігання сесії

### Cookie (основний спосіб)

```
Name: garden_session
Value: encrypted_session_id
Flags: HttpOnly, Secure, SameSite=Strict
TTL: 24h (owner), термін зони (гість)
```

### LocalStorage (резервний варіант для зон)

```javascript
localStorage.setItem('garden_zone_access', JSON.stringify({
  zoneId: 'zone_abc',
  code: 'ZONE-XXXX-YYYY',
  expiresAt: '2024-01-15T12:00:00Z'
}));
```

---

## 5. Поточний статус реалізації

| Функція | Статус | Розташування |
|---------|--------|--------------|
| Вхід Owner | ✅ Готово | `OwnerLoginDialog.tsx` |
| JWT валідація | ✅ Готово | Worker `/auth/validate` |
| Створення зон | 🔴 Зламано | Worker `/zones/create` |
| Валідація зон | ⚠️ Частково | Worker `/zones/validate` |
| Access Gate UI | ❌ TODO | `AccessGate.tsx` |
| Cookie сесія | ❌ TODO | Worker + Frontend |

---

## Семантичні зв'язки

**Цей документ деталізує:**
- [[БЕЗПЕКА_СИСТЕМИ]] — принципи безпеки системи
- [[АРХІТЕКТУРНИЙ_КОРІНЬ]] — A5 Gateway як єдина точка входу

**Суміжні документи:**
- [[КОНТРАКТИ_API_V1]] — endpoints `/auth/login`, `/zones/validate`
- [[ADR_ФЕДЕРАТИВНА_СИСТЕМА_КОМЕНТАРІВ]] — використовує ту ж модель доступу для коментарів

---

*Цей документ описує модель доступу Digital Garden exodus.pp.ua.*
